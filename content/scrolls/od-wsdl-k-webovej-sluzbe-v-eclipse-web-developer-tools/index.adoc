---
title: Od WSDL k webovej službe -- Používame Eclipse Web Developer Tools
date: 2019-10-10
draft: true
---

:icons: font

== Úvod
Ukážeme si, ako je možné pomocou *Eclipse Web Developer Tools* rýchlo vytvoriť WSDL pre webovú službu spolu so schémou pre dokumenty, čím si urobíme výborný základ pre interoperabilitu medzi platformami.

== Požadovaný softvér
Budeme potrebovať *Eclipse IDE* a modul *Eclipse Java Web Developer Tools*. Jeho súčasťou je podpora pre vývoj webových služieb protokolu SOAP (_Web Service Tools_).

== Webová služba na základe WSDL

=== Ustanovenie vstupno-výstupných dokumentov

Pri návrhu webových služieb založených na kontrakte (*contract-based*) sa často vychádza z dokumentov, ktoré sa posielajú do príslušných operácií, resp. sú ich výsledkom.

Ak by sme chceli navrhovať metódu pre prekladový slovník, môžeme do služby poslať nasledovný dokument:

	<word lang="sk">pes</dog>

Keďže jazyk je metainformácia (informácia o slove *pes*), je lepšie ho uviesť do XML atribútu než do samostatného elementu.

Výstupom prekladovej služby by mohol byť dokument s viacerými slovami:

	<words lang="en">
		<word>dog</word>
		<word>hound</word>
	</word>

Služba je navyše dostatočne flexibilná, aby mohla perspektívne vracať preklady z ľubovoľného jazyka do ľubovoľného iného.

=== Návrh XML schémy

Ak máme ujasnené dokumenty, môžeme navrhovať schému. V Eclipse môžeme zvoliť **New | File | XML | XML Schema File** a vytvoriť súbor `schema.xsd`.

Vygeneruje sa štandardná prázdna schéma:

	<?xml version="1.0" encoding="UTF-8"?>
	<schema xmlns="http://www.w3.org/2001/XMLSchema"
			targetNamespace="http://www.example.org/schema"
			xmlns:tns="http://www.example.org/schema"
			elementFormDefault="qualified">
	</schema>

_Eclipse IDE_ poskytuje dedikovaný grafický editor pre tvorbu schémy. Na spodku okna máme dve karty:

* *Design* s vizuálnym klikacím nástrojom
* *Source* s editorom zdrojového XML

Nezabudnime si zobraziť pohľad (_view_) *Properties*, ktorý zobrazí vlastnosti vybranej položky. Dostaneme sa k nemu cez *Window | Show View | Properties*.

Akčný plán na návrh schémy bude nasledovný:

. Upravíme cieľový menný priestor schémy.
. Upravíme prefix cieľového priestoru.
. Pripravíme definíciu elementu pre požiadavku SOAP služby.
. Pripravíme definíciu elementu pre odpoveď.

=== Menné priestory

Kliknime na fialový nadpis _Schema : http://www.example.org/schema_. V pohľade _Properties_ vieme nastaviť dve vlastnosti:

* *Prefix*: nastavme prefix cieľového menného priestoru, napr. na `x`.
* *Target Namespace*: cieľový menný priestor XML schémy nastavme na `urn:example:translator`

Ak sa prepneme do režimu zdrojového kódu (_Source_), uvidíme vygenerovaný kód:

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<schema targetNamespace="urn:example:translator"
        xmlns:x="urn:example:translator"
        xmlns="http://www.w3.org/2001/XMLSchema"
        elementFormDefault="qualified">

</schema>
----

Menný priestor `urn:example:translator` je náš vlastný menný priestor, v duchu špecifikácie https://tools.ietf.org/html/rfc6963[RFC6963: A Uniform Resource Name (URN) Namespace for Examples].

== Definícia elementu pre požiadavku

Ak používame vizuálny návrh, kliknime na blok *Elements* a pridajme nový element cez kontextové menu a *Add Element*.

Eclipse vytvorí zástupný element `NewElement : string`. Kliknime naň a nastavme mu:

* *Name*: názov elementu, teda `word`.
* *Type*, teda typ. Z rozbaľovacieho comboboxu vyberme možnosť *New*, pretože potrebujeme definovať nový typ tohto elementu.

=== Typ elementu

Eclipse zobrazí dialóg pre výber typu elementu. Obsah elementu `word` je síce jednoduchý (obsahuje jedine text), ale vzhľadom na použitie atribútu ho musíme deklarovať ako komplexný typ. Pomenujme ho ako `Word` (s veľkým W).

Eclipse vygeneruje do bloku *Types* nový typ, a použije ako ako typ `x:Word` v type elementu `<word>`.

==== Atribút `lang`

Pridajme teraz atribút `lang`. Na type `Word` v bloku *Types* vyvolajme kontextové menu a zvoľme položku *Add Attribute*. Editor sa vnorí o úroveň nižšie, kde zobrazí len detaily tohto typu.

image::type-and-attributes.png[]

Po kliknutí na zástupný atribút `NewAttribute`:

* zmeňme jeho názov na `lang`
* preverme jeho dátový typ, ktorý je zatiaľ `string`, čo nám vyhovuje.

Kliknutím na tlačidlo v ľavom hornom rohu *Show Schema Index View* sa vynoríme naspäť na prehľad schémy.

Editor vygeneroval nasledovný zdrojový kód:

[source,xml]
----
<element name="word" type="x:Word"></element>
<complexType name="Word">
    <attribute name="lang" type="string"></attribute>
</complexType>
----

==== Deklarácia typu vnútra

Ešte potrebujeme deklarovať vnútro elementu `word`, pretože v tejto podobe schéma nič nehovorí o jeho obsahu.

Schéma XML pre element, ktorý je jednoduchého typu, ale obsahuje atribút, musí z technických dôvodov vyzerať nasledovne:

* Typ je deklarovaný ako komplexný typ.
* Typ textového obsahu špecifikuje odvodením (extenziou) od základného typu, napr. reťazca.

Kliknime opäť na typ `Word` a z vlastností vyberme možnosť *Inherit From*. Z rozbaľovacieho menu zvolíme *Browse...*, kde z následného dialógu vyberieme typ `string`.

Editor následne upraví kód typu:
[source,xml]
----
<complexType name="Word">
    <simpleContent>
        <extension base="string">
            <attribute name="lang" type="string"></attribute>
        </extension>
    </simpleContent>
</complexType>
----

=== Cvičné vygenerovanie inštancie

Eclipse umožňuje vygenerovať inštanciu XML schémy. Ak v pohľade _Project Explorer_ klikneme na súbor so schémou a vyvoláme *Generate | XML File...*

image::new-xml-file.png[]

Umožní nám vybrať najmä:

* *root element*, teda koreňový element dokumentu. Keďže v schéme sme deklarovali jediný možný element, máme na výber len túto možnosť.
* *fill elements and attributes with data*: predvyplní povonné atribúty a obsahy cvičnými dátami.
* *namespace declarations*: vidíme deklarácie menných priestorov a prefixov. Zadefinuje sa rovnaký prefix a menný priestor, ktorý deklaruje schéma ako cieľový.

Výsledná inštancia vyzerá nasledovne:
[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<x:word xmlns:x="urn:example:translator" <!--1-->
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="urn:example:translator schema.xsd <!--2-> ">x:word</x:word> <!--3-->
----
<1> Deklaruje menný priestor `urn:example:translator` a jeho prefix `x`.
<2> Priamo asociuje inštanciu so súborom XML schémy
<3> Predvyplní hodnotu textového obsahu.

Atribút `lang`, ktorý nie je povinný, vynechá.

== Definícia elementu pre odpoveď

V schéme XML teraz pridáme druhý element do bloku *Elements*. Z kontextového menu zopakujeme *Add Element*, kde vyplníme meno (_name_) `words` a pre typ (_Type_) vytvoríme nový typ (_New Type..._)

==== Typ elementu

Pre typ elementu zvolíme *ComplexType* s názvom `Words`. V bloku typov sa tak objaví už druhý typ.

Pridajme doňho element pre jednotlivé preklady, teda sadu `<word>`. Na type `Words` vyvolajme kontextové menu a pridajme nový element pomocou *Add Element*. Editor sa opäť zahĺbi o úroveň nižšie a pridá element s provizórnym názvom `NewElement` typu `string`.

Kliknime na tento nový element a nastavme mu:

* názov (_name_) na `word`
* typ (_type_) ponechajme reťazcový `string`
* minimálny počet (_minimum occurences_) výskytov uveďme ako 0, čo je pre situáciu, keď sa pre slovo nenájdu žiadne preklady a vrátime prázdny zoznam slov, teda rodičovský element `<words>` nebude obsahovať nič.
* maximálny počet (_maximum occurences_) nastavme na *unbounded*, teda neohraničený.

image::complex-type-words.png[]

Všimnime si, ako editor vizuálne zvýrazní typ, jeho názov, a kardinalitu (počty výskytov).

Editor vygeneroval nasledovné prvky do schémy:

[source,xml]
----
<element name="words" type="x:Words"></element>

<complexType name="Words">
    <sequence>
        <element name="word" type="string" minOccurs="0" maxOccurs="unbounded"></element>
    </sequence>
</complexType>
----

Pridajme ešte aj atribút `lang`. Vyvolajme kontextové menu na type `Words` a zvoľme *Add Attribute*. Opäť sa zanoríme o úroveň nižšie a uvidíme provizórny atribút `NewAttribute` typu `string`>
Kliknime naňho, zobrazme jeho vlastnosti a nastavme:

* *name* (_názov_) na `lang`
* *type* (_typ_) na `string`
* *usage* indikujúci povinnosť atribútu na `required`, čím z neho spravíme povinný atribút.

Editor dogeneruje do schémy nový atribút, v elemente `<attribute`>:
[source,xml]
----
<complexType name="Words">
    <sequence>
        <element name="word" type="string" minOccurs="0"
            maxOccurs="unbounded">
        </element>
    </sequence>
    <attribute name="lang" type="string" use="required"></attribute>
</complexType>
----

=== Cvičné vygenerovanie inštancie
Ak si necháme vygenerovať inštanciu (súbor schémy *| Generate | XML File...*), a ako koreňový element zvolíme *words*, uvidíme výsledok:

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<x:words lang=""
     xmlns:x="urn:example:translator"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="urn:example:translator schema.xsd "></x:words>
----

Keďže atribút `lang` je povinný, v inštancii sa teraz nachádza, i keď s prázdnou hodnotou.



////

### Schéma pre element pre vstup

Ak chceme v XML schéme deklarovať element s textom a jedným atribútom, použime vzor prevzatý zo [Zvon.org](http://zvon.org/xxl/XMLSchemaTutorial/Output/ser_simpleContent_st8.html):

	<xsd:element name="word">
		<xsd:complexType>
			<xsd:simpleContent>
				<xsd:extension base="xsd:string">
					<xsd:attribute name="lang" type="xsd:string" use="required" />
				</xsd:extension>
			</xsd:simpleContent>
		</xsd:complexType>
	</xsd:element>

Deklarujeme element `word`, ktorý obsahuje jednoduchý obsah cez `simpleContent` s dátovým typom *reťazec* (`xsd:string`). Tento dátový typ obohatíme cez `extension` o nutnosť (`use="required"`) vlastniť atribút `lang` typu `xsd:string`.

### Schéma pre element pre výstup
Element pre výstupné dokumenty bude o niečo jednoduchší. Keďže má obsahovať podelementy, v schéme ho deklarujeme cez `complexType` a sekvenciu (`sequence`). Jednotlivé elementy `word` obsahujú len text, čiže reťazce `string`.

Keďže slová sa majú opakovať (viacero elementov `word` za sebou), nastavíme maximálny výskyt (`maxOccurs`) na neohraničený (`unbounded`). Zároveň môžeme zaviesť situáciu, keď sa pre slovo nenájdu žiadne preklady a vrátiť prázdny zoznam slov, čiže umožniť aj situáciu, keď sa element `word` nebude vyskytovať v rodičovi `words` ani raz: dosiahneme to nulovým minimálnym výskytom (`minOccurs="0"`˙):

Na záver zavedieme do schémy povinný atribút `lang` s jazykom v podobnom duchu, ako sme to robili pre atribút jedného slova vo vstupnom dokumente.

	<xsd:element name="words">
		<xsd:complexType>
			<xsd:sequence>
				<xsd:element name="word"
							 type="xsd:string"
							 minOccurs="0"
							 maxOccurs="unbounded"/>
			</xsd:sequence>
			<xsd:attribute name="lang" type="xsd:string" use="required" />
		</xsd:complexType>
	</xsd:element>

### Výsledná schéma
Výsledná schéma môže vyzerať nasledovne:

	<?xml version="1.0" encoding="UTF-8"?>
	<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"
		targetNamespace="urn:X-kopr" xmlns="urn:X-kopr" elementFormDefault="qualified">

		<xsd:element name="word">
			<xsd:complexType>
				<xsd:simpleContent>
					<xsd:extension base="xsd:string">
						<xsd:attribute name="lang" type="xsd:string" use="required" />
					</xsd:extension>
				</xsd:simpleContent>
			</xsd:complexType>
		</xsd:element>

		<xsd:element name="words">
			<xsd:complexType>
				<xsd:sequence>
					<xsd:element name="word"
								 type="xsd:string"
								 minOccurs="0"
								 maxOccurs="unbounded"/>
				</xsd:sequence>
				<xsd:attribute name="lang" type="xsd:string" use="required" />
			</xsd:complexType>
		</xsd:element>
	</xsd:schema>

Návrh WSDL
----------
Ak máme ujasnenú schému, môžeme navrhovať WSDL. V Eclipse môžeme zvoliť **New | File | Web Services | WSDL File** a vytvoriť súbor `words.wsdl`.

V dialógu potrebujeme vyplniť štyri základné veci:

*	*cieľový menný priestor*: reprezentuje jednoznačný menný priestor pre deklarácie v tomto WSDL dokumente. Podľa [obyčaje](http://www.w3.org/TR/2004/WD-wsdl20-primer-20041221/#basics-getting-started) je reprezentovaný URL adresou, na ktorej možno nájsť príslušný WSDL súbor.
*	unikátnosť menného priestoru (v celom šírom svete...): pomenovanie URL adresou ju vie automaticky zabezpečiť
*	potenciálnu možnosť navštíviť URL adresu a získať z nej autoritatívnu (kanonickú) podobu WSDL súboru. Toto však nie je bezpodmienečne nutné, ani vyžadované, a nie je vôbec vylúčené, že použijeme menný priestor, ktorý nie je URL adresou. Koniec-koncov, to sme robili pri mennom priestore pre XML schému, kde sme využili `urn:X-kopr`.
*	*prefix menného priestoru*:
*	vzhľadom na ťažkopádnosť pomenovaní menných priestorov možno využiť skratkový "alias", alebo prefix. V tomto prípade môžeme radostne použiť prefix `kopr` (alebo akýkoľvek iný).
*	*štýl webovej služby*:
*	ak chceme zachovať portabilitu a interop, využime jedinú možnosť: *document/literal*.
*	*protokol*:
*	využime možnosť **SOAP**.

Z Eclipsu vypadne obrovské automatické WSDL. Dávame ho len na ukážku, pretože si ho v ďalších pasážach postupne rozoberieme a primerane upravíme. Urýchliť pochopenie môže [samostatný článok "Od WSDL k webovej službe"](http://ics.upjs.sk/~novotnyr/wiki/Java/OdWSDLKWebovejSluzbe).

	<?xml version="1.0" encoding="UTF-8" standalone="no"?>
	<wsdl:definitions
			xmlns:kopr="urn:kopr"
			xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
			xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
			xmlns:xsd="http://www.w3.org/2001/XMLSchema"
			name="words"
			targetNamespace="urn:kopr">

	  <wsdl:types>
	    <xsd:schema targetNamespace="urn:kopr">
	      <xsd:element name="NewOperation">
	        <xsd:complexType>
	          <xsd:sequence>
	            <xsd:element name="in" type="xsd:string"/>
	          </xsd:sequence>
	        </xsd:complexType>
	      </xsd:element>
	      <xsd:element name="NewOperationResponse">
	        <xsd:complexType>
	          <xsd:sequence>
	            <xsd:element name="out" type="xsd:string"/>
	          </xsd:sequence>
	        </xsd:complexType>
	      </xsd:element>
	    </xsd:schema>
	  </wsdl:types>

	  <wsdl:message name="NewOperationRequest">
	    <wsdl:part element="kopr:NewOperation" name="parameters"/>
	  </wsdl:message>
	  <wsdl:message name="NewOperationResponse">
	    <wsdl:part element="kopr:NewOperationResponse" name="parameters"/>
	  </wsdl:message>

	  <wsdl:portType name="words">
	    <wsdl:operation name="NewOperation">
	      <wsdl:input message="kopr:NewOperationRequest"/>
	      <wsdl:output message="kopr:NewOperationResponse"/>
	    </wsdl:operation>
	  </wsdl:portType>

	  <wsdl:binding name="wordsSOAP" type="kopr:words">
	    <soap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
	    <wsdl:operation name="NewOperation">
	      <soap:operation soapAction="urn:kopr/NewOperation"/>
	      <wsdl:input>
	        <soap:body use="literal"/>
	      </wsdl:input>
	      <wsdl:output>
	        <soap:body use="literal"/>
	      </wsdl:output>
	    </wsdl:operation>
	  </wsdl:binding>

	  <wsdl:service name="words">
	    <wsdl:port binding="kopr:wordsSOAP" name="wordsSOAP">
	      <soap:address location="http://www.example.org/"/>
	    </wsdl:port>
	  </wsdl:service>

	</wsdl:definitions>

Vzájomné prepojenie vidieť na diagrame:

![](http://i.im
gur.com/FvgJP6A.png)

Ak si prepneme zobrazenie na grafické, uvidíme vo finále prepojenie a významy jednotlivých blokov:

![](http://i.imgur.com/JyYCCB7.png)

### Grafický editor v Eclipse

Demonštrácia použitia WSDL editora v Eclipse, vytvorenie ukážkového WSDL na zelenej lúke a prepojenie s existujúcou schémou je znázornená [v samostatnom videu.](http://ics.upjs.sk/~novotnyr/home/skola/konkurentne-programovanie/2013/wsdl.htm)


Literatúra
==========
*	[Od WSDL k webovej službe](http://ics.upjs.sk/~novotnyr/wiki/Java/OdWSDLKWebovejSluzbe), článok vo Wiki o budovaní webovej služby na základe WSDL.
*	[WSDL Essentials](http://oreilly.com/catalog/webservess/chapter/ch06.html), Chapter 6 in *Web Services Essentials [Distributed Applications with XML-RPC, SOAP, UDDI & WSDL]*, O'Reilly 2002.
